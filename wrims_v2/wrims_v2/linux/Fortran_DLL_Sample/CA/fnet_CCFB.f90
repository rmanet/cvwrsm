module fnet_CCFB

! a = 0.00088789
! b = -0.053594

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.021660473617,-0.603644524031,-0.643654752454,-0.005987175681,0.040150437046,-0.061821851360,0.136422362981,-0.299939685516,-0.044000627662,-0.589594827449,0.139359641512,0.413971978235 &
            ,0.025714285561,0.223308066634,-0.714600583764,-1.114839863998,0.135107500406,-0.376777941770,-0.082728713379,1.339571366204,-0.126455199352,0.282272373322,-0.658901744494,-1.093411489585 &
            ,0.081574143567,0.066892231902,-0.288710355863,0.369957542363,-0.065502517173,-0.027768636771,0.573105487599,0.566508360934,-0.348969016020,-0.247654658739,0.365286612226,-2.104624057777 &
            ,0.303337261783,-0.170393919906,0.078525220838,0.363564094975,0.150247591471,0.328884868740,-0.151380574668,0.757371096268,-0.125971007500,0.020251684763,1.119707446380,1.107372647224 &
            ,0.025829726792,-0.485505958713,0.286816556758,0.859028595862,-0.023242066155,0.321149706441,-1.376593989914,-1.717166225119,-0.119112129389,0.300967423579,0.035851985449,-1.267753339135 &
            ,0.090029562995,-0.347399265259,0.279606193693,0.830656039511,0.068067023327,0.127722395884,0.373906072797,0.655316539682,-0.064276238232,0.219283466429,-0.467352186789,-0.303670544702 &
            ,0.042252128510,0.671465171242,1.064842869554,0.911763445563,-0.030262826599,0.608603879677,-0.669277387155,-0.314960759852,-0.066723111054,0.277066458049,0.510690086610,0.242625027551 &
            ,0.061677131040,0.530012249030,0.037781027620,0.238482496041,-0.104877515836,0.002559661464,0.275852198085,0.249781557249,0.099070785969,0.686219373283,-0.032530681979,0.028351306433 &
            ,-0.158562839953,-0.028515376825,-0.615329178046,-0.857101825579,0.110397451853,0.187039200714,0.186825743608,0.154439617144,-0.146029173495,-0.453555508829,-0.348880417715,-0.387361447301 &
            ,0.065072451426,0.219885458083,0.352303089939,0.163110513166,0.001050978345,-0.259854591881,-0.296571180454,-0.475627804941,-0.160793880529,-0.588113987346,-0.111873800061,-0.310083729996 &
            ,0.279038529559,0.055833727042,-0.036743515972,0.000300056408,-0.736398650099,-1.608661553248,0.026302300256,0.126056151703,0.046167375563,0.184582665231,0.411752901763,0.318072813520 &
            ,-0.095503505331,0.042844583076,-0.181705486043,0.009203528857,0.030567775991,0.181513034512,-0.112569948720,-0.140210258248,-0.028741457796,-0.113071988246,-0.010358734776,0.114751408174 &
            ,0.217898622728,-0.144945512562,1.456587654397,3.117066408574,-0.187230957410,1.224537647823,-1.915725532773,-1.958726077025,0.148615032921,0.358474605701,0.436572046106,0.950810406365 &
            ,-0.139835370310,0.321950015798,-0.677093074075,-0.083748263449,0.159751837587,2.168316983739,-1.839519389676,-2.782639879801,-0.133124950953,-1.628141591661,2.141488073616,3.310885574221 &
            ,-0.140725211864,-1.258847457881,0.426276641780,0.646307562674,0.129938905379,0.469948351160,-1.269714525506,-1.902793551765,-0.154941306476,0.555987093613,-3.475062243933,-5.555460836132 &
            ,0.112906797240,-2.854154648934,1.147825653538,1.342007935996,0.119557062871,0.235837719354,0.181957541092,0.541891321981,-0.094794528295,0.165794734342,-1.296894454354,-0.749057845084 &
            ,0.061441927766,0.019128263074,-0.201143330361,0.286647553833,-0.044764582248,-0.027729578571,0.393233588982,0.475281459529,0.016864207915,-2.258813121952,2.543770640582,4.994139552905 &
            ,-0.050534961877,2.277044416588,-1.976310637122,-3.225534894095,0.000774167339,-0.412117963864,0.486239965794,1.167804158234,0.001900117116,0.573561132899,0.030012220210,-0.282864597641 &
            ,0.039414008732,0.297573976273,0.089648767821,0.700421958582,-0.016185038892,0.433090117964,2.226550762143,2.434280163719,0.019112073901,0.114323792773,-0.318917620930,-0.358890146276 &
            ,-0.022162274461,-0.278973270234,0.148977521852,0.170571327339,0.057540105667,0.017399833893,0.005140333900,0.519984495998,-0.045241369491,0.181643370964,0.000756731979,0.015397184993 &
            ,0.083274702177,0.145649316023,0.357555745762,0.907138642596,-0.073094461584,0.384704706850,0.020650284057,0.148535918126,-0.041757455119,-0.258893531464,0.043447292090,-0.176025589043 &
            ,0.020812600565,-0.176086256063,-0.063196624404,-0.279502390584,-0.007610912782,0.045935864085,0.188109027538,0.025083084065,-0.010365686950,-0.025200772034,0.207974460950,0.252396576057 &
            ,-0.009700165108,0.133144527247,0.371115144472,0.347697142925,0.042489268292,0.358565877142,-0.026463325030,0.112776339555,0.008975310516,-0.201890419697,0.544175001569,0.775106677371 &
            ,0.008822277008,0.422694096150,-0.480457189785,-0.497367743878,0.081819291625,-0.316361245400,0.817356824460,1.759123585415,-0.045865807446,0.816636489768,-0.946273680472,-1.012625123876 &
            ,0.029343532744,0.179277169474,0.281777099267,0.386156305032,-0.016665747405,0.146654724296,0.671760143026,0.705309029471,0.090966044574,0.996193573887,-0.601912095124,-0.848005169968 &
            ,-0.072284133963,-0.532581015622,1.466192813589,1.952069001152,0.164124756070,0.444998419110,0.342717853257,1.233284755124,-0.119371408652,0.422101934337,0.563131746141,0.726613502604 &
            ,0.265848593656,0.998046267934,0.143871362037,1.301909178023,-0.228717851525,0.321003761404,0.567382710308,0.952829400714,0.067233698185,0.040233025337,0.287227721852,1.099189033093 &
            ,-0.021730288527,0.653780333528,-0.386826785463,-0.513569933472,0.037148388042,-0.405974675159,0.254398108669,1.211512527387,-0.023653981855,0.651049994797,-0.986628970809,-1.363735230587 &
            ,-0.042447457706,-0.911802121033,0.571012616211,1.475076784293,0.059882954962,0.889381978925,-1.137133894723,-1.733364419690,-0.125878840414,-0.396340514324,-0.161608465834,-0.482799344622 &
            ,0.100756599720,-0.004079159554,-0.171824461838,-0.429286376476,0.068291951936,0.362223505293,-0.421866650818,-0.215544536047,-0.056723099658,-0.211733601960,0.807513882529,1.268490434272 &
            ,0.247043483055,1.038015376070,-0.345069466910,0.347374638754,-0.240725490444,-0.316186746717,1.149066593747,1.968638956409,0.010538976057,0.083758018467,-0.156004313203,-0.155363046787 &
            ,-0.005407288568,-0.088826657290,0.028189813727,0.083187693832,0.025265539128,0.113424738920,-0.100972476701,-0.037388376502,-0.021823972316,-0.064638272047,0.111256854405,0.199258966420 &
            ,0.024413403534,0.149682246434,-0.124696878462,-0.123545567356,-0.022228457714,-0.110353102450,0.164507742339,0.272441591880,0.024034394991,0.195767552406,-0.088198905341,-0.087420918391 &
            ,-0.015096716922,-0.064419638105,0.213661195925,0.349070389171,0.028445409704,0.073627668738,-0.114654275059,-0.052982789574,-0.032861215465,-0.105447203278,0.006899645896,0.079614673129 &
            ,-0.006671322787,0.052899326703,0.010621807587,-0.055793572143,0.007077286125,0.011140767103,0.034550205123,0.083665351825,0.001225146652,0.128571568248,-0.164899615803,-0.224653572469 &
            ,0.003154669507,-0.095783706865,0.271309056560,0.328412215477,0.000176392209,-0.002424627164,-0.024966132765,-0.041502223747,0.002119253605,-0.027178484248,0.026814345842,0.048380857602 &
            ,0.178089303018,0.804779941766,-1.226944160187,-0.157542744099,-0.148869288186,-0.092869389924,2.646987571770,3.197994172792,-0.141863615818,-1.635359034870,1.008194068027,1.012360234823 &
            ,0.126531834565,0.765328500023,-2.761532706177,-3.380400753979,-0.015461794310,2.940913921672,-0.186351981599,-3.223237049783,0.001091133772,-1.926021778203,-0.037450097544,0.847289846450 &
            ,-0.052544446655,1.823650936037,-1.176781917146,-2.641871089477,0.058780743774,-1.263668220587,6.480313728658,7.341491927208,-0.273610111327,0.121432662917,-4.327373273806,-6.937624294588 &
            ,0.249350003033,-3.057973626855,-1.882647631690,-2.535172881634,0.481080568279,1.745113700945,-0.188866016696,0.992957188432,-0.432192168506,0.250650088811,-3.955468267577,-2.689753309196 &
            ,0.359277065319,-1.712615878243,1.603660860578,4.703951903195,-0.295647796367,2.241153200552,-4.229574090082,-3.549619997509,-1.039376096848,-7.183862318213,2.715523916784,3.308616406158 &
            ,0.908009217154,2.767694754210,-3.143412828564,-8.310483392173,-0.255645407877,-0.664044230714,0.164905579768,-1.725985298455,0.215342589065,-0.355120916687,-5.268823405875,-6.145735782912 &
            ,0.081687833453,-1.567448929329,2.469050610654,3.230574002365,-0.062978508311,1.928862165533,-3.075013265199,-2.160021396559,0.224701888465,-1.782376218850,-3.251136936197,-3.034004263298 &
            ,-0.208443973522,-3.161268948950,0.410254980098,-0.026491038284,-0.991017239987,-1.986034432994,-6.080421777885,-5.422997637595,0.914627072539,-1.237419419674,3.333919385006,-0.220923899198 &
            ,-0.066080203337,-2.433091190661,-7.155660027707,-5.973599938906,0.009398272927,-3.387564471699,2.537563600032,1.233797714313,-0.149378148844,0.321152163125,-3.425595102944,-8.110474848762 &
            ,0.174499448180,-7.338151712979,2.616662163390,0.538392247138,-0.454025698644,3.277982829018,-0.608512189442,-10.231378339132,0.213967004535,-5.228419154643,0.948099631527,1.819633056453 &
            ,-0.745267739732,5.556724319250,-1.423813151191,-11.017378314493,0.826783342763,-0.718154012840,-1.578933078174,4.044023571646,0.239037899603,5.455710396932,-2.730718503398,-9.000036223957 &
            ,-0.251559963905,-4.366231656710,-0.189736417815,3.761332790555,-0.388485253807,2.164389262893,-3.610729307551,-8.207406346723,0.323608783680,-4.310549040584,3.122521178323,3.110290798963 &
            ,0.530443225995,1.789122622442,1.351331826008,2.822080124011,-0.465726982390,0.682472648233,-1.641804614646,-0.715742133462,-0.058047385259,0.630060390751,0.736472993222,-0.640312787921 &
            ,0.041344172099,0.211683262234,-1.272723972893,-0.639823872766,0.246748655956,2.527131003117,-1.744844423264,-3.022310271393,-0.211431434173,-1.273118880484,-1.240859642438,1.382751622480 &
            ,-0.070644388435,-0.171534308802,0.720995207644,-0.232908888954,0.059239517448,0.138659355657,-2.715478737099,-2.981209703100,-0.192234986439,0.279068323820,-4.022634752903,-5.643098091978 &
            ,0.152223710554,-2.609809556914,0.976530170830,0.063840026651,0.439818020991,2.465156199159,0.598501716318,0.286196538838,-0.369390205405,0.460388006507,-5.259340007287,-3.527379701615 &
            ,-0.365089877422,1.517082825077,-0.758881464888,-5.208689263569,0.310790732112,-1.783400179619,1.656698189935,2.061465975761,-0.009626050485,-2.203034736499,0.999886798059,2.223041746571 &
            ,-0.013030777082,1.513033357024,-7.803913698533,-9.963125941482,0.170586973489,3.493358688246,0.219192128472,-3.353930031397,-0.141850156368,-0.779399840042,-5.482282658417,-3.925326878120 &
            ,-0.086509866012,0.506154266660,0.884288734132,-0.131036439163,0.078234645104,-0.108731639709,-2.206150837113,-3.063516425022,0.179210834703,0.048625727558,0.241241824922,1.568461832482 &
            ,-0.161121258291,0.556510340908,-0.039370223088,0.136946795405,0.079926375126,0.721900364903,0.331757422748,0.221997406366,-0.069788732858,0.197438640060,-0.116676704575,0.448151551052 &
            ,-0.045152160959,-0.171923467716,0.532811571430,0.347924265303,0.032816775666,0.287360413271,-0.562010018862,-0.668203877118,-0.282926752940,-0.680192615335,-0.854648154591,-2.563314449939 &
            ,0.238954591393,-0.856819610358,0.089395456809,-0.180247349573,-0.144948818036,0.047823960951,-1.883155091799,-2.821787944160,0.116854167792,-1.109667954285,0.816818423732,0.935289526663 &
            ,-0.135512761259,0.089560520778,-0.182914600833,-1.280171300090,0.155621266512,-0.633625249441,0.056886765448,-0.274233831939,0.277626957733,0.625181529044,0.475220079979,2.087268617075 &
            ,-0.254422759657,0.579907111710,1.288363441083,1.687330038869,0.134350400705,0.201712880346,0.160874487019,1.265963844925,-0.097744374966,0.503563240738,1.333971172332,1.676477593506 &
            ,-0.025740409742,-0.145201252693,-0.068487250122,-0.077188203965,0.026728714623,0.018867287543,-0.109829993244,-0.174815331362,0.019694771401,-0.052238387674,0.132291278407,0.315223282192 &
            ,-0.019995877158,0.115806966151,-0.073125006707,-0.073361108823,0.040559072455,0.175111755249,0.077049129150,0.254288327327,-0.043907694827,0.042850405730,0.630773609091,0.688574741926 &
            ,-0.057834410029,-0.366332266497,-0.019102027988,-0.053023347525,0.053828315918,0.034243277269,-0.293511904857,-0.518472801647,0.016119478070,0.274775666800,0.229484573610,0.081393854714 &
            ,-0.007145820552,0.110680073821,-0.081419520160,0.187652783227,-0.061756255993,0.064686233797,-0.470917252165,-1.004238083390,0.057315506324,-0.437778675540,0.516357966377,0.561950207784 &
            ,0.070418257282,-0.032865449496,0.165674054179,0.839768840085,-0.062440279141,0.260298771416,0.171215977399,0.089389803398,-0.044825467522,-0.637209889873,0.619643529402,0.846869974193 &
            ,0.034823235577,0.483398705424,-1.004271495922,-1.257672033284,-0.003261563022,-0.498178608939,0.269867220745,0.634293776960,0.008179868694,0.286729971016,-0.564269069198,-0.694110301523 &
            ,-0.035245482228,-0.717754016709,0.250170400975,0.423117863739,0.030963416901,0.251634427519,-0.820568438520,-1.011839988378,-0.033002350479,-0.128548757502,-0.024294584090,-0.220125079161 &
            ,0.024720247816,-0.067543125599,-0.158730537337,-0.200113899565,-0.000962322178,-0.070124221108,0.000380127925,0.037199155579,0.001242665402,0.014482742818,0.003955503917,-0.017652979076 &
            ,-0.008297881889,-0.108687019457,0.071912510150,0.122336329912,0.017026591887,0.118168256877,-0.111430585925,-0.113167237199,0.008140705057,0.050328343110,0.208672475053,0.307307072985 &
            ,0.005352138599,0.172925212771,0.102044808771,0.124527519989,-0.003438027162,-0.214254447581,0.176876953782,0.288111947362,-0.013810105007,0.099284256991,-0.086604207514,-0.191464428627 &
            ,0.002031597162,-0.171881756572,0.047027137690,0.180288251892,-0.004145054729,0.037843676234,0.191106210399,0.115903269024,-0.049558024301,-0.380865642488,0.870736855673,0.929111598346 &
            ,0.034268236930,0.611027058468,-0.386970517885,-0.533591419186,-0.009822270536,-0.590689754396,0.474427361018,0.971125687413,0.017253050377,0.485050941312,-0.486363358259,-0.782163246968 &
            ,-0.001108020950,-0.342831414222,0.146034412486,0.542846814001,0.002550351788,0.249202200658,-0.311439721974,-0.541134325575,-0.021042139699,-0.138297298313,-0.114208229987,-0.046487061683 &
            ,0.018929737109,-0.019502478356,0.008919071982,-0.146745609106,-0.034764693565,-0.265847398755,0.135745753271,0.220674085628,0.034156812330,0.168001093971,-0.175558074240,-0.325710181418 &
            ,-0.010947779728,0.117477001421,0.007104691751,-0.107830345490,0.013473068212,-0.002045457416,0.370986231223,0.453079416881,0.046754248347,0.049398976212,-0.041575749780,0.268474769427 &
            ,-0.038086734716,0.007784806598,0.105072328144,0.039891375728,-0.016191383820,-0.449077030203,0.249144425433,0.554098090987,0.017698154270,0.275217552702,-0.572394699658,-0.854884230173 &
            ,-0.051355435668,-0.215663251918,0.117105085445,-0.042439335555,0.047726955959,0.073754446934,-0.023950779978,-0.137149547896,-0.019920833857,-0.218806889633,0.251252556598,0.318158367269 &
            ,0.016936473965,0.183488502496,-0.044738571247,-0.205029470308,-0.006969812693,-0.047775100205,0.059575699735,0.003338458849,0.004203963536,0.013436775173,0.083087084301,0.037419183612 &
            ,-0.041327841668,-0.015488885528,-0.007073923055,-0.328559858206,0.033260083764,-0.054993965955,0.160124188994,0.217131779337,-0.007267772317,-0.017492422416,-0.055606372422,-0.066937319820 &
            ,0.010326611608,-0.019091518934,0.043126290950,0.019328973072,-0.002390750190,-0.010565321275,-0.006370185080,-0.018256689496,-0.000698955980,-0.010434601663,0.021366306242,0.014863052377 &
            ,-0.000278375732,-0.003393710985,-0.008101097998,-0.021246854931,-0.003643604229,-0.021524186140,0.032865583167,0.030762550499,-0.001082345913,0.001561351260,-0.022104986555,-0.058361408372 &
            ,-0.001304455139,-0.034229191929,0.016635207381,0.027801945236,-0.003865133782,-0.008412900278,0.001711984572,-0.024666877335,-0.000454534964,-0.011401369843,0.027297171026,0.024469994831 &
            ,-0.009568941252,0.008714449656,-0.011500710012,-0.047719161699,0.014606063193,0.014128851031,0.048897629332,0.053530771153,-0.004936653068,0.025104957076,-0.034959855080,-0.081800816618 &
            ,0.006841964941,-0.024060743967,0.063591501591,0.079393987432,-0.001283388821,0.021999623176,0.006842386616,-0.032860362997,-0.000230817918,-0.010375933719,0.063212060117,0.089463284245 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/3.4333,15.479 &
            ,0.0060982,-3.0407,5.4452,-3.2818 &
            ,-5.8341,3.0506 &
            ,3.942,-7.6232 &
            ,-1.0351,5.2318 &
            ,-0.014054,3.8084 &
            ,0.0089694,-3.0851 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-24.1656,-21.4007/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/0.37547,-2.1564,-2.2353,-3.0153,-0.13106,-0.50883,7.1345,6.4218/)
real, dimension(2) :: bias2 = &
  (/-0.96102,-12.8673/)
real, dimension(1) :: bias3 = &
  (/23.0116/)
contains
subroutine fnet_CCFB_initall()
end subroutine fnet_CCFB_initall
subroutine fnet_CCFB_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
    inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_CCFB_engine
end module fnet_CCFB
